FROM node:18.7.0-bullseye-slim

ARG USER
ARG GROUP
ENV USER=${USER}
ENV GROUP=${GROUP}
USER ${USER}:${GROUP}

RUN mkdir /usr/src/app
WORKDIR /usr/src/app

COPY --chown=${USER}:${GROUP} package.json .
COPY --chown=${USER}:${GROUP} yarn.lock .

# RUN chown -R ${USER}:${GROUP} ./node_modules/

RUN yarn add pg

RUN yarn install

COPY --chown=${USER}:${GROUP} . .

EXPOSE 3001

CMD [ "yarn", "start:dev"]